$(document).ready(function(){var e=$("#formProduct"),t=$("#alertModal"),o=$("#modalProduct"),r=null;function n(){$("#modalProduct").modal("hide"),t.find("h5").text("Unexpected error occurred. Enter data again."),t.modal("show")}jQuery.validator.setDefaults({debug:!0,success:"valid"}),e.validate({rules:{productDescription:{required:!0,maxlength:256},productName:{required:!0,maxlength:256}},submitHandler:function(e){e.submit()}}),$(document).on("click",".editProduct",function(e){e.preventDefault();var t=$(this).parent(".parentItem");r=t.attr("data-product-id");var n=$("#tr-"+r),d=n.find(".tr-description").get(0).innerText,a=n.find(".tr-name").get(0).innerText;$("#ProductName").val(a),$("#ProductDescription").val(d),o.addClass("isEdit"),o.modal("show")}),$(document).on("click",".deleteProduct",function(e){e.preventDefault();var o=$(this).parent(".parentItem");r=o.attr("data-product-id"),t.find("h5").text("Are you sure?"),t.find(".modal-footer").append('<button type="button" class="btn btn-danger btnRemove" data-dismiss="modal">Remove</button>'),t.modal("show")}),$(document).on("click",".btnRemove",function(e){e.preventDefault();var o=$("#tr-"+r);$.post({data:{__RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val(),storeId:$("#StoreId").val(),productId:r},url:"/management/deleteproduct",success:function(e){!1===e.error?(t.find("h5").text("Product removed successfully."),t.modal("show"),o.remove()):(console.log(e.message),n())},error:function(e,t,o){console.log(o),n()},complete:function(){}})}),$(".btnModalProduct").on("click",function(d){if(d.preventDefault(),e.valid()){var a=e.find("input, button");if(a.prop("disabled",!0),o.hasClass("isEdit")){var i=$("#ProductName").val().trim(),c=$("#ProductDescription").val().trim();$.post({data:{__RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val(),ProductName:i,ProductDescription:c,storeId:$("#StoreId").val(),productId:r},url:"/management/editproduct",success:function(e){if(!1===e.error){$("#modalProduct").modal("hide");var o=$("#tr-"+r);o.find(".tr-description").get(0).innerText=c,o.find(".tr-name").get(0).innerText=i,t.find("h5").text("Product edit successfully."),t.modal("show")}else console.log(e.message),n()},error:function(e,t,o){console.log(o),n()},complete:function(){a.prop("disabled",!1),o.removeClass("isEdit")}})}else $.post({data:{__RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val(),ProductName:$("#ProductName").val(),ProductDescription:$("#ProductDescription").val(),storeId:$("#StoreId").val()},url:"/management/createproduct",success:function(e){var o,r;!1===e.error?($("tbody").append((o=e,(r=document.createElement("tr")).id="tr-"+o.productId,r.innerHTML='<td class="tr-name">'+o.name+'</td><td class="tr-description">'+o.description+'</td><td class="parentItem" data-product-id="'+o.productId+'"><a href="#" class="btn btn-primary editProduct" ><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a> | <a href="#" class="btn btn-primary deleteProduct"><i class="fa fa-trash-o" aria-hidden="true"></i></a></td>',r)),$("#modalProduct").modal("hide"),t.find("h5").text('Product "'+e.name+'" created successfully.'),t.modal("show")):(console.log(e.message),n())},error:function(e,t,o){console.log(o),n()},complete:function(){a.prop("disabled",!1)}})}}),$("#modalProduct").on("hidden.bs.modal",function(){r=null,$("#ProductName").val(null),$("#ProductDescription").val(null)}),t.on("hidden.bs.modal",function(){!function(){t.find("h5").text("");var e=t.find(".btnRemove");e.length&&e.remove()}()})});